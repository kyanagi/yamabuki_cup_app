# 2R裏 勝抜け者入力 要件定義

## 1. 背景
現行実装では、2R裏の試合について他試合と同様に得点入力・得点表示を行う前提になっている。
一方、運用上の2R裏は得点経過を扱わず、試合終了後に勝抜け者のみを確定する方式で進行するため、実運用に合わせた仕様へ変更する。

## 2. 対象範囲
- 対象ラウンド: 2R裏の全試合
- 対象ユーザー: `admin` と `staff`
- 非対象: 2R裏以外のラウンド

## 3. 目的
- 2R裏の得点表示・得点入力を廃止する。
- 試合終了後に、各試合の勝抜け者4名と順位（1位〜4位）を登録できるようにする。

## 4. 業務ルール
- 勝抜け人数は各試合4名固定（`docs/spec/tournament_rule.md` の現行ルールに従う）。
- 同順位は不可。
- 順位は `1, 2, 3, 4` の一意な値のみ許可する。
- 順位を記録する対象は勝抜け者4名のみとする。

## 5. 機能要件

### 5.1 2R裏の得点入力・得点表示の廃止
- 2R裏では得点入力UIを表示しない。
- 2R裏では画面上の得点表示を行わない。

### 5.2 勝抜け者入力導線
- 2R裏の試合画面（または管理導線）に、得点入力UIの代わりとして「勝抜け者入力フォーム」へのリンクを表示する。

### 5.3 勝抜け者入力フォーム
- 対象試合の参加者一覧を表示する。
- 一覧から勝抜け者を4名選択できる。
- 各勝抜け者に対して順位（1位〜4位）を設定できる。
- 入力は試合終了後に4名分をまとめて行う。

### 5.4 バリデーション
保存時に以下を満たさない場合はエラーとする。
- 勝抜け者がちょうど4名である。
- 選択された4名が重複していない。
- 順位が `1, 2, 3, 4` の4値すべてで構成される。
- 同一試合の参加者以外は選択できない。

### 5.5 更新（再編集）
- 一度保存した後も、`admin` と `staff` は再編集可能とする。
- 再編集時は最新内容で上書き保存する。
- 変更履歴は保持しない。

### 5.6 権限制御
- 2R裏の勝抜け者入力・更新は `admin` と `staff` の双方に許可する。

## 6. データ要件
- 試合経過（問題ごとの進行、正誤履歴など）および各選手の得点は記録しない。
- 各試合について、勝抜け者4名とその順位（1〜4）のみを記録対象とする。
- 既存の2R裏得点データとの互換性は考慮しない（既存データは事前に削除する前提）。

## 7. 非機能・運用要件
- 権限外ユーザーは勝抜け者入力フォームにアクセスできない。
- 入力エラー時は、どの条件に違反したかを画面上で判別できること。

## 8. スコープ外
- 後続処理（次ラウンド進出処理や他機能への連動）の変更は行わない。
- 勝抜け者確定の履歴管理機能は実装しない。

## 9. 受け入れ基準
- 2R裏の試合で得点入力UIが表示されない。
- 2R裏の試合で得点表示が行われない。
- 2R裏の試合で勝抜け者入力フォームへのリンクが表示される。
- 対象試合の参加者から4名を選択し、順位1〜4を一意に指定して保存できる。
- 4名未満/超過、重複選択、同順位、順位欠落の場合は保存できずエラー表示される。
- `admin` と `staff` の両方で入力・更新できる。
- 保存後に再編集して上書きできる。
- 上記操作で、得点や試合経過の記録は新規作成されない。
