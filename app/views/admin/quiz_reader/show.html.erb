<div data-controller="quiz-reader"
  data-quiz-reader-question-id-value="<%= @next_question.id %>"
  data-quiz-reader-sound-id-value="<%= @next_question.id % 2 %>"
  data-action="
  keydown.space@document->quiz-reader#startReading:prevent
  keyup.space@document->quiz-reader#pauseReading:prevent
  keydown.right@document->quiz-reader#proceedToNextQuestion:prevent
  keydown.r@document->quiz-reader#resetReading:prevent
  ">
  <nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item">
          <div class="buttons">
            <button class="button" data-action="click->quiz-reader#switchToQuestion">
              <span class="icon"><i class="fa-solid fa-list-ol"></i></span>
              <span>問題選択</span>
            </button>
            <button class="button is-warning" data-quiz-reader-target="settingsButton" data-action="click->quiz-reader#openSettingsModal">
              <span class="icon"><i class="fa-solid fa-gear"></i></span>
              <span>設定</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <div class="container">
    <h1 class="title">Quiz Reader</h1>
  <div class="field">
    <label class="switch is-rounded">
      <input type="checkbox" data-quiz-reader-target="isOnAir" data-action="change->quiz-reader#applyOnAirStateToUI" checked>
      <span class="check is-danger"></span>
      <span class="control-label" data-quiz-reader-target="onAirLabel">問い読みON</span>
    </label>
    <label class="switch is-rounded ml-4">
      <input type="checkbox" data-quiz-reader-target="isQuestionFollowOn" data-action="change->quiz-reader#applyQuestionFollowStateToUI" checked>
      <span class="check is-info"></span>
      <span class="control-label" data-quiz-reader-target="questionFollowLabel">問題フォローON</span>
    </label>
  </div>
  <div class="field">
    <div class="control is-flex">
      <div class="mr-5">
        <span class="kbd">Space</span>
        <span class="ml-1">再生</span>
      </div>
      <div class="mr-5">
        <span class="kbd">→</span>
        <span class="ml-1">次の問題</span>
      </div>
      <div>
        <span class="kbd">R</span>
        <span class="ml-1">再生状態のリセット</span>
      </div>
    </div>
  </div>
  <!-- メイン画面のエラー表示 -->
  <p class="help has-text-danger is-hidden" data-quiz-reader-target="mainError"></p>
  <div class="columns">
    <div class="column is-7">
      <h2 class="title is-4">Next</h2>
      <div id="next_questions" class="block" data-quiz-reader-target="nextQuestions">
        <% if @next_question %>
          <%= render partial: "admin/quiz_reader/next_question/next_question", locals: { question: @next_question } %>
        <% end %>
        <% if @next2_question %>
          <%= render partial: "admin/quiz_reader/next_question/next2_question", locals: { question: @next2_question } %>
        <% end %>
      </div>
    </div>
    <div class="column is-5">
      <h2 class="title is-4">History</h2>
      <div id="reading_histories">
        <%= render partial: "admin/quiz_reader/histories", locals: { reading_histories: @reading_histories } %>
      </div>
    </div>
  </div>

  <!-- 設定モーダル -->
  <div class="modal" data-quiz-reader-target="settingsModal">
    <div class="modal-background" data-action="click->quiz-reader#closeSettingsModal"></div>
    <div class="modal-content">
      <div class="box">
        <h2 class="title is-4">設定</h2>

        <!-- 音声フォルダ選択 -->
        <div class="field">
          <label class="label">音声フォルダ</label>
          <div class="control is-flex is-align-items-center">
            <button class="button" data-action="click->quiz-reader#selectFolder">
              <span class="icon"><i class="fa-solid fa-folder-open"></i></span>
              <span>選択</span>
            </button>
            <span class="ml-3 has-text-grey" data-quiz-reader-target="folderStatus">
              未選択
            </span>
          </div>
        </div>

        <!-- 音量調整 -->
        <div class="field">
          <label class="label">音量</label>
          <div class="control is-flex is-align-items-center">
            <input type="number" min="0" max="100" step="1" value="100"
                   class="input" style="width: 5rem;"
                   data-quiz-reader-target="volumeInput"
                   data-action="input->quiz-reader#setVolumeFromInput">
            <input type="range" min="0" max="100" value="100"
                   class="ml-3" style="flex: 1;"
                   data-quiz-reader-target="volumeSlider"
                   data-action="input->quiz-reader#setVolumeFromSlider">
          </div>
        </div>

        <!-- サンプル音声 -->
        <div class="field">
          <label class="label">サンプル音声</label>
          <div class="buttons">
            <button class="button is-primary" disabled data-quiz-reader-target="samplePlayButton" data-action="click->quiz-reader#playSampleAudio">
              <span class="icon"><i class="fa-solid fa-play"></i></span>
              <span>再生</span>
            </button>
            <button class="button is-danger" disabled data-quiz-reader-target="sampleStopButton" data-action="click->quiz-reader#stopSampleAudio">
              <span class="icon"><i class="fa-solid fa-stop"></i></span>
              <span>停止</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <button class="modal-close is-large" aria-label="close" data-action="click->quiz-reader#closeSettingsModal"></button>
  </div>
  </div>
</div>
